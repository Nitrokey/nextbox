{"version":3,"sources":["../lib/requesttoken.ts"],"names":["tokenElement","document","getElementsByTagName","token","getAttribute","observers","getRequestToken","onRequestTokenUpdate","observer","push","e","forEach","console","error"],"mappings":";;;;;;;;;;AAAA;;AAEA,IAAMA,YAAY,GAAGC,QAAQ,CAACC,oBAAT,CAA8B,MAA9B,EAAsC,CAAtC,CAArB;AACA,IAAIC,KAAK,GAAGH,YAAY,GAAGA,YAAY,CAACI,YAAb,CAA0B,mBAA1B,CAAH,GAAoD,IAA5E;AAMA,IAAMC,SAAmC,GAAG,EAA5C;;AAEO,SAASC,eAAT,GAA0C;AAChD,SAAOH,KAAP;AACA;;AAEM,SAASI,oBAAT,CAA8BC,QAA9B,EAAiE;AACvEH,EAAAA,SAAS,CAACI,IAAV,CAAeD,QAAf;AACA,C,CAED;;;AACA,yBAAU,mBAAV,EAA+B,UAAAE,CAAC,EAAI;AACnCP,EAAAA,KAAK,GAAGO,CAAC,CAACP,KAAV;AAEAE,EAAAA,SAAS,CAACM,OAAV,CAAkB,UAAAH,QAAQ,EAAI;AAC7B,QAAI;AACHA,MAAAA,QAAQ,CAACE,CAAC,CAACP,KAAH,CAAR;AACA,KAFD,CAEE,OAAOO,CAAP,EAAU;AACXE,MAAAA,OAAO,CAACC,KAAR,CAAc,oCAAd,EAAoDH,CAApD;AACA;AACD,GAND;AAOA,CAVD","sourcesContent":["import { subscribe } from '@nextcloud/event-bus'\n\nconst tokenElement = document.getElementsByTagName('head')[0]\nlet token = tokenElement ? tokenElement.getAttribute('data-requesttoken') : null\n\ninterface CsrfTokenObserver {\n\t(token: string): void;\n}\n\nconst observers: Array<CsrfTokenObserver> = []\n\nexport function getRequestToken(): string | null {\n\treturn token\n}\n\nexport function onRequestTokenUpdate(observer: CsrfTokenObserver): void {\n\tobservers.push(observer)\n}\n\n// Listen to server event and keep token in sync\nsubscribe('csrf-token-update', e => {\n\ttoken = e.token\n\n\tobservers.forEach(observer => {\n\t\ttry {\n\t\t\tobserver(e.token)\n\t\t} catch (e) {\n\t\t\tconsole.error('error updating CSRF token observer', e)\n\t\t}\n\t})\n})\n"],"file":"requesttoken.js"}